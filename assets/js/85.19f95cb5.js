(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{661:function(e,a,s){"use strict";s.r(a);var _=s(7),t=Object(_.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"æäº¤ç»“æœ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æäº¤ç»“æœ"}},[e._v("#")]),e._v(" æäº¤ç»“æœ")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://my-imags.oss-cn-shanghai.aliyuncs.com/pic/20210224220213.png",alt:""}}),e._v("\nå®Œæ•´é¡ºäº†ä¸€ébaselineï¼Œç”¨KNNè¿›è¡Œç»çº¬åº¦è·ç¦»è®¡ç®—ï¼Œåˆ†æ•°æœ‰æé«˜ä¸€ç‚¹ï½")]),e._v(" "),s("h2",{attrs:{id:"èµ›é¢˜ä»»åŠ¡è§£æ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#èµ›é¢˜ä»»åŠ¡è§£æ"}},[e._v("#")]),e._v(" èµ›é¢˜ä»»åŠ¡è§£æ")]),e._v(" "),s("h3",{attrs:{id:"èµ›é¢˜ä»»åŠ¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#èµ›é¢˜ä»»åŠ¡"}},[e._v("#")]),e._v(" èµ›é¢˜ä»»åŠ¡")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("èµ›é¢˜ä»»åŠ¡")]),e._v("ï¼šè¯†åˆ«å‡ºå·¥ä½œæ—¥æ—©é«˜å³°07:00-09:00æ½®æ±ç°è±¡æœ€çªå‡ºçš„40ä¸ªåŒºåŸŸï¼Œé’ˆå¯¹Top40åŒºåŸŸè®¡ç®—ç»“æœè¿›ä¸€æ­¥è®¾è®¡é«˜å³°æœŸå…±äº«å•è½¦æ½®æ±ç‚¹ä¼˜åŒ–æ–¹æ¡ˆï¼›")]),e._v(" "),s("li",[s("code",[e._v("èµ›é¢˜æ•°æ®")]),e._v("ï¼šå…±äº«å•è½¦è½¨è¿¹æ•°æ®ã€å…±äº«å•è½¦åœè½¦ç‚¹ä½ï¼ˆç”µå­å›´æ ï¼‰æ•°æ® å’Œ å…±äº«å•è½¦è®¢å•æ•°æ®ï¼›")])]),e._v(" "),s("h3",{attrs:{id:"æ•°æ®è¯´æ˜"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ•°æ®è¯´æ˜"}},[e._v("#")]),e._v(" æ•°æ®è¯´æ˜")]),e._v(" "),s("ul",[s("li",[e._v("gxdc_gj20201221.csvï¼šå…±äº«å•è½¦è½¨è¿¹æ•°æ®\n"),s("ul",[s("li",[e._v("BICYCLE_IDï¼šè½¦è¾†ç¼–ç ")]),e._v(" "),s("li",[e._v("LOCATING_TIMEï¼šå®šä½æ—¶é—´")]),e._v(" "),s("li",[e._v("LATITUDEï¼šçº¬åº¦ï¼ˆWGS84åæ ‡ï¼‰")]),e._v(" "),s("li",[e._v("LONGITUDEï¼šç»åº¦ï¼ˆWGS84åæ ‡ï¼‰")])])]),e._v(" "),s("li",[e._v("gxdc_tcd.csvï¼šå…±äº«å•è½¦åœè½¦ç‚¹ä½ï¼ˆç”µå­å›´æ ï¼‰æ•°æ®\n"),s("ul",[s("li",[e._v("FENCE_IDï¼šç”µå­å›´æ å”¯ä¸€ç¼–å·")]),e._v(" "),s("li",[e._v("FENCE_LOCï¼šç”µå­å›´æ ä½ç½®åæ ‡ä¸²ï¼ˆåŒ…æ‹¬ç”µå­å›´æ æ‰€åœ¨ä½ç½®å››ä¸ªé¡¶ç‚¹çš„åæ ‡ä¿¡æ¯ï¼ŒWGS84åæ ‡ï¼‰")])])]),e._v(" "),s("li",[e._v("gxdc_dd.csvï¼šå…±äº«å•è½¦è®¢å•æ•°æ®\n"),s("ul",[s("li",[e._v("BICYCLE_IDï¼šè½¦è¾†ç¼–ç ")]),e._v(" "),s("li",[e._v("LATITUDEï¼šçº¬åº¦ï¼ˆWGS84åæ ‡ï¼‰")]),e._v(" "),s("li",[e._v("LONGITUDEï¼šç»åº¦ï¼ˆWGS84åæ ‡ï¼‰")]),e._v(" "),s("li",[e._v("LOCK_STATUSï¼šé”çš„çŠ¶æ€ï¼ˆ0-å¼€é”ï¼Œ1-å…³é”ï¼‰")]),e._v(" "),s("li",[e._v("UPDATE_TIMEï¼šé”çŠ¶æ€æ›´æ–°æ—¶é—´")])])])]),e._v(" "),s("h3",{attrs:{id:"æ•°æ®æ¢ç´¢"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ•°æ®æ¢ç´¢"}},[e._v("#")]),e._v(" æ•°æ®æ¢ç´¢")]),e._v(" "),s("h4",{attrs:{id:"è½¨è¿¹æ•°æ®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è½¨è¿¹æ•°æ®"}},[e._v("#")]),e._v(" è½¨è¿¹æ•°æ®")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("è¯»å–æ•°æ® æ‹¼æ¥ä¸åŒå¤©çš„å•è½¦è½¨è¿¹æ•°æ®ï¼Œé»˜è®¤axis=0ï¼ŒæŒ‰è¡Œæ‹¼æ¥")]),e._v(" "),s("p",[e._v("bike_track = pd.concat([\npd.read_csv(PATH + 'gxdc_gj20201221.csv'),\npd.read_csv(PATH + 'gxdc_gj20201222.csv'),\npd.read_csv(PATH + 'gxdc_gj20201223.csv'),\npd.read_csv(PATH + 'gxdc_gj20201224.csv'),\npd.read_csv(PATH + 'gxdc_gj20201225.csv')")])])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("])\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[s("p",[e._v("è·¯çº¿å¯è§†åŒ– foliumç”¨äºåœ°å›¾çš„å¯è§†åŒ–")]),e._v(" "),s("h1",{attrs:{id:"åˆå§‹åŒ–ä¸­å¿ƒä½ç½®å’Œç¼©æ”¾å°ºåº¦"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åˆå§‹åŒ–ä¸­å¿ƒä½ç½®å’Œç¼©æ”¾å°ºåº¦"}},[e._v("#")]),e._v(" åˆå§‹åŒ–ä¸­å¿ƒä½ç½®å’Œç¼©æ”¾å°ºåº¦")])])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("m = folium.Map(location=[24.482426, 118.157606], zoom_start=12)\n# åˆå§‹åŒ–å•è½¦çš„è½¨è¿¹\nmy_PolyLine = folium.PolyLine(locations=bike_track[bike_track['BICYCLE_ID'] == '000152773681a23a7f2d9af8e8902703']\n                             [['LATITUDE', 'LONGITUDE']].values, weight=5)\n# å°†è½¨è¿¹æ·»åŠ è‡³åº•å›¾\nm.add_child(my_PolyLine)\n# ä¿å­˜åœ°å›¾åˆ°html\nm.save('../output/track_example.html')\n")])])]),s("p",[e._v("ç¤ºä¾‹ï¼šå¯è§†åŒ–ä¸€è¾†å•è½¦ä¸€å¤©çš„è½¨è¿¹ ![](https://my-imags.oss-cn-\nshanghai.aliyuncs.com/pic/20210224221345.png)")]),e._v(" "),s("h4",{attrs:{id:"ç”µå­å›´æ æ•°æ®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç”µå­å›´æ æ•°æ®"}},[e._v("#")]),e._v(" ç”µå­å›´æ æ•°æ®")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("è¯»å–æ•°æ®")]),e._v(" "),s("p",[e._v("def bike_fence_format(s):\ns = s.replace('[', '').replace(']', '').split(',')\ns = np.array(s).astype(float).reshape(5, -1)\nreturn s")])])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("bike_fence = pd.read_csv(PATH + 'gxdc_tcd.csv')\nbike_fence['FENCE_LOC'] = bike_fence['FENCE_LOC'].apply(bike_fence_format)\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[s("p",[e._v("å›´æ å¯è§†åŒ–")]),e._v(" "),s("p",[e._v("fence_map = folium.Map(location=[24.482426, 118.157606], zoom_start=12)")])])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("# é€ä¸ªç‚¹æ ‡è®°ï¼Œé€ä¸ªç‚¹æ·»ğŸ è‡³åº•å›¾\nfor data in bike_fence['FENCE_LOC'].values[:100]:\n   folium.Marker(list(data[0, ::-1])).add_to(fence_map)\nfence_map.save('../output/fence_example.html')\n")])])]),s("p",[e._v("ç¤ºä¾‹ï¼šåœ¨åœ°å›¾ä¸Šæ ‡è®°å‰100ä¸ªç”µå­å›´æ çš„ç‚¹ ![](https://my-imags.oss-cn-\nshanghai.aliyuncs.com/pic/20210224222116.png)")]),e._v(" "),s("h4",{attrs:{id:"è®¢å•æ•°æ®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è®¢å•æ•°æ®"}},[e._v("#")]),e._v(" è®¢å•æ•°æ®")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("è¯»æ•°æ®")]),e._v(" "),s("p",[e._v("bike_order = pd.read_csv(PATH + 'gxdc_dd.csv')")])])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("bike_order = bike_order.sort_values(['BICYCLE_ID', 'UPDATE_TIME'])\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[s("p",[e._v("å•è½¦ä½ç½®å¯è§†åŒ–")]),e._v(" "),s("p",[e._v("order_map = folium.Map(location=[24.482426, 118.157606], zoom_start=12)")])])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("# ä¸€è¾†å•è½¦å„ä¸ªæ—¶åˆ»çš„è½¨è¿¹ç‚¹ï¼Œè¿æ¥æˆçº¿\norder_PolyLine = folium.PolyLine(locations=bike_order[bike_order['BICYCLE_ID'] == '0000ff105fd5f9099b866bccd157dc50']\n                                [['LATITUDE', 'LONGITUDE']].values, weight=5)\norder_map.add_child(order_PolyLine)\norder_map.save('../output/order_example.html')\n")])])]),s("p",[e._v("ç¤ºä¾‹ï¼šä¸€è¾†å•è½¦å¤šå¤©çš„è½¨è¿¹ ![](https://my-imags.oss-cn-\nshanghai.aliyuncs.com/pic/20210224222640.png)")]),e._v(" "),s("h2",{attrs:{id:"å…±äº«å•è½¦æ½®æ±ç‚¹åˆ†æ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å…±äº«å•è½¦æ½®æ±ç‚¹åˆ†æ"}},[e._v("#")]),e._v(" å…±äº«å•è½¦æ½®æ±ç‚¹åˆ†æ")]),e._v(" "),s("h3",{attrs:{id:"åˆ†æç›®æ ‡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åˆ†æç›®æ ‡"}},[e._v("#")]),e._v(" åˆ†æç›®æ ‡")]),e._v(" "),s("ul",[s("li",[e._v("å…±äº«å•è½¦è®¢å•ä¸åœè½¦ç‚¹åŒ¹é…")]),e._v(" "),s("li",[e._v("ç»Ÿè®¡å¹¶å¯è§†åŒ–åœè½¦ç‚¹æ½®æ±æƒ…å†µ")]),e._v(" "),s("li",[e._v("è®¡ç®—å·¥ä½œæ—¥æ—©é«˜å³°07:00-09:00æ½®æ±ç°è±¡æœ€çªå‡ºçš„40ä¸ªåŒºåŸŸ")])]),e._v(" "),s("h3",{attrs:{id:"æ•°æ®å¤„ç†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ•°æ®å¤„ç†"}},[e._v("#")]),e._v(" æ•°æ®å¤„ç†")]),e._v(" "),s("h4",{attrs:{id:"ç”µå­å›´æ æ•°æ®å¤„ç†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç”µå­å›´æ æ•°æ®å¤„ç†"}},[e._v("#")]),e._v(" ç”µå­å›´æ æ•°æ®å¤„ç†")]),e._v(" "),s("p",[e._v("â€‹"),s("br"),e._v("\n# å¾—å‡ºåœè½¦ç‚¹ LATITUDE èŒƒå›´\nbike_fence['MIN_LATITUDE'] = bike_fence['FENCE_LOC'].apply(lambda x: np.min(x[:, 1]))\nbike_fence['MAX_LATITUDE'] = bike_fence['FENCE_LOC'].apply(lambda x: np.max(x[:, 1]))")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("# å¾—åˆ°åœè½¦ç‚¹ LONGITUDE èŒƒå›´\nbike_fence['MIN_LONGITUDE'] = bike_fence['FENCE_LOC'].apply(lambda x: np.min(x[:, 0]))\nbike_fence['MAX_LONGITUDE'] = bike_fence['FENCE_LOC'].apply(lambda x: np.max(x[:, 0]))\n\nfrom geopy.distance import geodesic\n# ä½¿ç”¨æµ‹åœ°çº¿è·ç¦»è¡¡é‡ç”µå­å›´æ çš„é¢ç§¯\nbike_fence['FENCE_AREA'] = bike_fence.apply(lambda x: geodesic(\n    (x['MIN_LATITUDE'], x['MIN_LONGITUDE']), (x['MAX_LATITUDE'], x['MAX_LONGITUDE'])\n).meters, axis=1)\n\n# è®¡ç®—ç”µå­å›´æ çš„ä¸­å¿ƒç»çº¬åº¦\nbike_fence['FENCE_CENTER'] = bike_fence['FENCE_LOC'].apply(\n    lambda x: np.mean(x[:-1, ::-1], 0)\n)\n")])])]),s("h3",{attrs:{id:"è®¢å•æ•°æ®å¤„ç†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è®¢å•æ•°æ®å¤„ç†"}},[e._v("#")]),e._v(" è®¢å•æ•°æ®å¤„ç†")]),e._v(" "),s("p",[e._v("â€‹"),s("br"),e._v("\n# è®¢å•æ•°æ®çš„æ—¶é—´ç‰¹å¾æå–\nbike_order['UPDATE_TIME'] = pd.to_datetime(bike_order['UPDATE_TIME'])\nbike_order['DAY'] = bike_order['UPDATE_TIME'].dt.day.astype(object)\nbike_order['DAY'] = bike_order['DAY'].apply(str)")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("bike_order['HOUR'] = bike_order['UPDATE_TIME'].dt.hour.astype(object)\nbike_order['HOUR'] = bike_order['HOUR'].apply(str)\nbike_order['HOUR'] = bike_order['HOUR'].str.pad(width=2,side='left',fillchar='0')\n\n# æ—¥æœŸå’Œæ—¶é—´è¿›è¡Œæ‹¼æ¥\nbike_order['DAY_HOUR'] = bike_order['DAY'] + bike_order['HOUR']\n")])])]),s("h4",{attrs:{id:"geohashç¼–ç ç»çº¬åº¦"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#geohashç¼–ç ç»çº¬åº¦"}},[e._v("#")]),e._v(" Geohashç¼–ç ç»çº¬åº¦")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("geohashåŸºæœ¬åŸç†ï¼š æ˜¯å°†åœ°çƒç†è§£ä¸ºä¸€ä¸ªäºŒç»´å¹³é¢ï¼Œå°†å¹³é¢é€’å½’åˆ†è§£æˆæ›´å°çš„å­å—ï¼Œæ¯ä¸ªå­å—åœ¨ä¸€å®šç»çº¬åº¦èŒƒå›´å†…æ‹¥æœ‰ç›¸åŒçš„ç¼–ç ")])]),e._v(" "),s("li",[s("p",[e._v("geohashç‰¹æ€§ï¼š")]),e._v(" "),s("ol",[s("li",[e._v("ä¸åŒçš„ç¼–ç é•¿åº¦ï¼Œè¡¨ç¤ºä¸åŒçš„èŒƒå›´åŒºé—´ï¼Œå­—ç¬¦ä¸²è¶Šé•¿ï¼Œè¡¨ç¤ºçš„èŒƒå›´è¶Šç²¾ç¡®\n2. å­—ç¬¦ä¸²ç›¸ä¼¼çš„è¡¨ç¤ºè·ç¦»ç›¸è¿‘\n"),s("img",{attrs:{src:"https://my-imags.oss-cn-shanghai.aliyuncs.com/pic/20210224224828.png",alt:""}})])])]),e._v(" "),s("li",[s("p",[e._v("å¯¹è®¢å•æ•°æ®å’Œç”µå­å›´æ æ•°æ®çš„ç»çº¬åº¦ä¿¡æ¯ï¼Œè¿›è¡Œgeohashç¼–ç ")]),e._v(" "),s("p",[e._v("import geohash")])])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("bike_order['geohash'] = bike_order.apply(\n   lambda x: geohash.encode(x['LATITUDE'], x['LONGITUDE'], precision=6), \naxis=1)\n\nbike_fence['geohash'] = bike_fence['FENCE_CENTER'].apply(\n   lambda x: geohash.encode(x[0], x[1], precision=6)\n)\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[e._v("geohashå­¦ä¹ ï¼š\n"),s("ol",[s("li",[s("a",{attrs:{href:"https://www.cnblogs.com/feiquan/p/11380461.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("geohashä»‹ç»"),s("OutboundLink")],1),e._v("\n2. "),s("a",{attrs:{href:"https://coggle.club/learn/dcic2020/task5",target:"_blank",rel:"noopener noreferrer"}},[e._v("DCIC2020"),s("OutboundLink")],1)])])])]),e._v(" "),s("h4",{attrs:{id:"ç”µå­å›´æ å†…æµé‡ç»Ÿè®¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç”µå­å›´æ å†…æµé‡ç»Ÿè®¡"}},[e._v("#")]),e._v(" ç”µå­å›´æ å†…æµé‡ç»Ÿè®¡")]),e._v(" "),s("p",[e._v("ä½¿ç”¨é€è§†è¡¨ç»Ÿè®¡æ¯ä¸ªåŒºåŸŸåœ¨ä¸åŒæ—¶é—´çš„å…¥æµé‡å’Œå‡ºæµé‡ï¼š")]),e._v(" "),s("p",[e._v("â€‹"),s("br"),e._v("\n# LOCK_STATUS=1,è¡¨ç¤ºå…³é”ï¼Œå°†å•è½¦åœå…¥ç”µå­å›´æ ï¼Œä¸ºå…¥æµé‡\nbike_inflow = pd.pivot_table(bike_order[bike_order['LOCK_STATUS'] == 1],\nvalues='LOCK_STATUS', index=['geohash'],\ncolumns=['DAY_HOUR'], aggfunc='count', fill_value=0\n)")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("bike_outflow = pd.pivot_table(bike_order[bike_order['LOCK_STATUS'] == 0], \n                   values='LOCK_STATUS', index=['geohash'],\n                    columns=['DAY_HOUR'], aggfunc='count', fill_value=0\n)\n")])])]),s("p",[s("img",{attrs:{src:"https://my-imags.oss-cn-shanghai.aliyuncs.com/pic/20210224230400.png",alt:""}})]),e._v(" "),s("h4",{attrs:{id:"ç”µå­å›´æ æ½®æ±æƒ…å†µå¯è§†åŒ–"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç”µå­å›´æ æ½®æ±æƒ…å†µå¯è§†åŒ–"}},[e._v("#")]),e._v(" ç”µå­å›´æ æ½®æ±æƒ…å†µå¯è§†åŒ–")]),e._v(" "),s("p",[e._v("â€‹"),s("br"),e._v("\nbike_inflow.loc['wsk593'].plot()\nbike_outflow.loc['wsk593'].plot()\nplt.xticks(list(range(bike_inflow.shape[1])), bike_inflow.columns, rotation=40)\nplt.legend(['å…¥æµé‡', 'å‡ºæµé‡'])")]),e._v(" "),s("p",[e._v("ä¸‹å›¾è¡¨ç¤ºï¼šwsk593ç¼–ç å¯¹åº”çš„åŒºåŸŸå¤šå¤©çš„å•è½¦åœå…¥é‡å’Œé©¶å‡ºé‡ ![](https://my-imags.oss-cn-\nshanghai.aliyuncs.com/pic/20210224225533.png)")]),e._v(" "),s("h3",{attrs:{id:"åŒ¹é…è®¡ç®—æ½®æ±"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åŒ¹é…è®¡ç®—æ½®æ±"}},[e._v("#")]),e._v(" åŒ¹é…è®¡ç®—æ½®æ±")]),e._v(" "),s("h4",{attrs:{id:"geohashåŒ¹é…"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#geohashåŒ¹é…"}},[e._v("#")]),e._v(" GeohashåŒ¹é…")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("è®¡ç®—æ¯ä¸ªåŒºåŸŸçš„ç•™å­˜æµé‡")]),e._v(" "),s("p",[e._v("bike_remain = (bike_inflow - bike_outflow).fillna(0)")])])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("# å­˜åœ¨éª‘èµ°çš„è½¦æ•°é‡ å¤§äº è¿›æ¥çš„è½¦æ•°é‡\nbike_remain[bike_remain < 0] = 0  \n\n# æŒ‰ç…§å¤©æ±‚å’Œï¼šæŸä¸ªåŒºåŸŸçš„å¤šå¤©çš„ç•™å­˜é‡ä¹‹å’Œ\nbike_remain = bike_remain.sum(1)\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[s("p",[e._v("ç»Ÿè®¡è¡—é“ç»´åº¦çš„æ½®æ±æƒ…å†µ")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("æå–è¡—é“ä¿¡æ¯ "),s("img",{attrs:{src:"https://my-imags.oss-cn-shanghai.aliyuncs.com/pic/20210224230910.png",alt:""}})]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v(" bike_fence['STREET'] = bike_fence['FENCE_ID'].apply(lambda x: x.split('_')[0])\n")])])])]),e._v(" "),s("li",[s("p",[e._v("è®¡ç®—è¡—é“çš„ç•™å­˜è½¦è¾†å¯†åº¦")])]),e._v(" "),s("li",[s("p",[e._v("å…ˆæŒ‰ç…§è¡—é“åç§°åˆ†ç»„")])]),e._v(" "),s("li",[s("p",[e._v("å†æå–å‡ºgeohashåˆ—")])]),e._v(" "),s("li",[s("p",[e._v("å†å¯¹geohashåˆ—å»é‡ï¼ˆä¸é‡å¤è®¡ç®—ç›¸åŒåŒºåŸŸçš„ç•™å­˜é‡ï¼‰")])]),e._v(" "),s("li",[s("p",[e._v("å†è®¡ç®—æ¯ä¸€ä¸ªç¼–ç åŒºåŸŸçš„ç•™å­˜è½¦è¾†")])]),e._v(" "),s("li",[s("p",[e._v("ç„¶åè®¡ç®—æ¯ä¸ªè¡—é“æ‰€æœ‰åŒºåŸŸçš„é¢ç§¯å’Œ")])]),e._v(" "),s("li",[s("p",[e._v("æœ€åæ±‚å‡ºè¡—é“ç»´åº¦çš„ç•™å­˜è½¦è¾†å¯†åº¦")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("   # ç•™å­˜è½¦è¾† / è¡—é“åœè½¦ä½æ€»é¢ç§¯ï¼Œè®¡ç®—å¾—åˆ°å¯†åº¦\n")])])]),s("p",[e._v("bike_density = bike_fence.groupby(['STREET'])['geohash'].unique().apply(\nlambda hs: np.sum([bike_remain[x] for x in hs])\n) / bike_fence.groupby(['STREET'])['FENCE_AREA'].sum()")])])]),e._v(" "),s("h1",{attrs:{id:"æŒ‰ç…§å¯†åº¦å€’åº"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æŒ‰ç…§å¯†åº¦å€’åº"}},[e._v("#")]),e._v(" æŒ‰ç…§å¯†åº¦å€’åº")]),e._v(" "),s("p",[e._v("bike_density = bike_density.sort_values(ascending=False).reset_index()")])])]),e._v(" "),s("h4",{attrs:{id:"è·ç¦»åŒ¹é…"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è·ç¦»åŒ¹é…"}},[e._v("#")]),e._v(" è·ç¦»åŒ¹é…")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("ä½¿ç”¨ç”µå­å›´æ çš„ä¸­å¿ƒç‚¹ç»çº¬åº¦æ•°æ®æ‹Ÿåˆknn haversineï¼šç»çº¬åº¦è®¡ç®—è·ç¦»")]),e._v(" "),s("p",[e._v("from sklearn.neighbors import NearestNeighbors")])])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("# https://scikit-learn.org/stable/modules/generated/sklearn.neighbors.DistanceMetric.html\nknn = NearestNeighbors(metric = \"haversine\", n_jobs=-1, algorithm='brute')\nknn.fit(np.stack(bike_fence['FENCE_CENTER'].values))\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[s("p",[e._v("æ‰¾åˆ°æ¯ä¸ªè®¢å•æœ€è¿‘çš„ä¸€ä¸ªç”µå­å›´æ ï¼Œï¼ˆè·ç¦»ï¼Œç”µå­å›´æ çš„indexï¼‰ å…¨é‡æ•°æ®è€—æ—¶çº¦5åˆ†é’Ÿ")]),e._v(" "),s("p",[e._v("dist, index = knn.kneighbors(bike_order[['LATITUDE','LONGITUDE']].values[:], n_neighbors=1)")])]),e._v(" "),s("li",[s("p",[e._v("è®¡ç®—æ‰€æœ‰åœè½¦ç‚¹çš„æ½®æ±æµé‡")]),e._v(" "),s("h1",{attrs:{id:"è®¢å•æœ€è¿‘çš„ç”µå­å›´æ çš„id"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è®¢å•æœ€è¿‘çš„ç”µå­å›´æ çš„id"}},[e._v("#")]),e._v(" è®¢å•æœ€è¿‘çš„ç”µå­å›´æ çš„ID")])])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("bike_order['fence'] = bike_fence.iloc[index.flatten()]['FENCE_ID'].values\n\n# æ•°æ®çš„æ¯ä¸€è¡Œä¸ºä¸€ä¸ªFENCE_IDï¼Œæ¯ä¸€åˆ—ä¸ºæŸå¤©çš„æµé‡\nbike_inflow = pd.pivot_table(bike_order[bike_order['LOCK_STATUS'] == 1], \n                  values='LOCK_STATUS', index=['fence'],\n                   columns=['DAY'], aggfunc='count', fill_value=0\n)\n\nbike_outflow = pd.pivot_table(bike_order[bike_order['LOCK_STATUS'] == 0], \n                  values='LOCK_STATUS', index=['fence'],\n                   columns=['DAY'], aggfunc='count', fill_value=0\n)\n\nbike_remain = (bike_inflow - bike_outflow).fillna(0)\nbike_remain[bike_remain < 0] = 0  \nbike_remain = bike_remain.sum(1)\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[s("p",[e._v("è®¡ç®—åœè½¦ç‚¹çš„å¯†åº¦ set_indexï¼šä½¿ç”¨FENCE_IDä½œä¸ºç´¢å¼•")]),e._v(" "),s("p",[e._v("bike_density = bike_remain / bike_fence.set_index('FENCE_ID')['FENCE_AREA']")])])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("bike_density = bike_density.sort_values(ascending=False).reset_index()\nbike_density = bike_density.fillna(0)\n")])])]),s("p",[s("img",{attrs:{src:"https://my-imags.oss-cn-shanghai.aliyuncs.com/pic/20210224235644.png",alt:""}})]),e._v(" "),s("h3",{attrs:{id:"ç»“æœè¾“å‡º"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç»“æœè¾“å‡º"}},[e._v("#")]),e._v(" ç»“æœè¾“å‡º")]),e._v(" "),s("p",[e._v("â€‹"),s("br"),e._v("\n# labelä¸´æ—¶ä½¿ç”¨ï¼Œåé¢è¢«FENCE_TYPEæ›¿æ¢\nbike_density['label'] = '0'\n# å‰100è¡Œçš„FENCE_TYPEè®¾ç½®ä¸º1\nbike_density.iloc[:100, -1] = '1'\nbike_density['BELONG_AREA'] = 'å¦é—¨'\n# åˆ é™¤åœè½¦ç‚¹çš„å¯†åº¦å±æ€§\nbike_density = bike_density.drop(0, axis=1)\nbike_density.columns = ['FENCE_ID', 'FENCE_TYPE', 'BELONG_AREA']\nbike_density.to_csv('../result/result.txt', index=None, sep='|')")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://my-imags.oss-cn-shanghai.aliyuncs.com/pic/20210224235401.png",alt:""}})]),e._v(" "),s("h2",{attrs:{id:"ä¼˜åŒ–æ–¹å‘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¼˜åŒ–æ–¹å‘"}},[e._v("#")]),e._v(" ä¼˜åŒ–æ–¹å‘")]),e._v(" "),s("ol",[s("li",[e._v("åŒºåŸŸç•™å­˜æµé‡çš„è®¡ç®—ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰å•è½¦é©¶å‡ºæ•°é‡å¤§äºé©¶å…¥æ•°é‡å¤šæƒ…å†µï¼Ÿä¸ºä»€ä¹ˆæ˜¯æ±‚å¤šå¤©ç•™å­˜é‡ä¹‹å’Œï¼Œä¸æ˜¯å¹³å‡ï¼Ÿ")]),e._v(" "),s("li",[e._v("ä½¿ç”¨ç”µå­å›´æ çš„ä¸­å¿ƒç‚¹ç»çº¬åº¦æ‹Ÿåˆknn")])])])}),[],!1,null,null,null);a.default=t.exports}}]);