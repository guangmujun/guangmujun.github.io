(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{593:function(t,a,s){"use strict";s.r(a);var n=s(7),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"_4web表单"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4web表单"}},[t._v("#")]),t._v(" 4Web表单")]),t._v(" "),s("blockquote",[s("p",[t._v("项目地址：https://gitee.com/guangmujun/micro-blog 个人网站：https://guangmujun.cn/")])]),t._v(" "),s("p",[t._v("Flask-WTF扩展 安装："),s("code",[t._v("conda install flask-wtf")])]),t._v(" "),s("h2",{attrs:{id:"_4-1-跨站请求伪造保护"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-跨站请求伪造保护"}},[t._v("#")]),t._v(" 4.1 跨站请求伪造保护")]),t._v(" "),s("p",[t._v("跨站请求伪造（CSRF） Flask-WTF通过设置密钥实现CSRF保护")]),t._v(" "),s("p",[t._v("​"),s("br"),t._v("\n​    app.config['SECRET_KEY'] = 'your secret key'")]),t._v(" "),s("p",[s("code",[t._v("app.config")]),t._v("字典用来存储框架、扩展和程序本身的配置变量 "),s("strong",[t._v("提醒")]),t._v("\n：为了增强安全性，密钥不应该直接写入代码，而是要保存在环境变量中，后续补充~")]),t._v(" "),s("h2",{attrs:{id:"_4-2-表单类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-表单类"}},[t._v("#")]),t._v(" 4.2 表单类")]),t._v(" "),s("p",[t._v("hello.py")]),t._v(" "),s("p",[t._v("​"),s("br"),t._v("\n​    from flask_wtf import FlaskForm\n​    from wtforms import StringField, SubmitField\n​    from wtforms.validators import DataRequired\n​"),s("br"),t._v("\nclass NameForm(FlaskForm):\nname = StringField('请输入你的名字：', validators=DataRequired())\nsubmit = SubmitField('提交')")]),t._v(" "),s("p",[t._v("字段")]),t._v(" "),s("ul",[s("li",[t._v("字段定义为类变量，如StringField")]),t._v(" "),s("li",[t._v("类变量的值，如name，即是StringField类的实例化对象")]),t._v(" "),s("li",[t._v("类的构造函数，如StringField中有两个参数，第一个参数是把表单渲染成HTML时使用的标号；第二个参数validators指定一个由验证函数组成的列表")]),t._v(" "),s("li",[t._v("常见字段：\n"),s("ul",[s("li",[t._v("TextAreaField-多行文本")]),t._v(" "),s("li",[t._v("PasswordField-密码文本")]),t._v(" "),s("li",[t._v("HiddenField-隐藏文本")]),t._v(" "),s("li",[t._v("DateField-datetime.date格式的文本")]),t._v(" "),s("li",[t._v("IntegerField-整数文本")]),t._v(" "),s("li",[t._v("BooleanField-复选框")]),t._v(" "),s("li",[t._v("SelectField-下拉列表")]),t._v(" "),s("li",[t._v("FileField-文件上传")])])])]),t._v(" "),s("p",[t._v("验证函数：")]),t._v(" "),s("ul",[s("li",[t._v("验证字段中的输入是否满足规定的条件")]),t._v(" "),s("li",[t._v("常见验证函数：\n"),s("ul",[s("li",[t._v("Email-验证电子邮件地址")]),t._v(" "),s("li",[t._v("EqualTo-比较两个字段的值是否相等")]),t._v(" "),s("li",[t._v("DataRequired-确保字段中有数据")])])])]),t._v(" "),s("h2",{attrs:{id:"_4-3-把表单渲染成html"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-把表单渲染成html"}},[t._v("#")]),t._v(" 4.3 把表单渲染成HTML")]),t._v(" "),s("p",[t._v("index.html")]),t._v(" "),s("p",[t._v("​"),s("br"),t._v('\n​    {% extends "base.html" %}\n​    {% import "bootstrap/wtf.html" as wtf %}\n​'),s("br"),t._v("\n{% block title %}Flasky{% endblock %}")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[t._v('{% block page_content %}\n<div class="page_content">\n    <div class="page-header">\n        <h1>你好, {% if name %}'+t._s(t.name)+"{% else %}陌生人{% endif %}!</h1>\n    </div>\n\n    "+t._s(t.wtf.quick_form(t.form))+'\n    <div class="page-bottom">\n        <p>日期：'+t._s(t.moment(t.current_time).format("LL"))+"</p>\n        <p>"+t._s(t.moment(t.current_time).fromNow(t.refresh=t.True))+" 来过</p>\n    </div>\n\n</div>\n{% endblock %}\n")])])]),s("h2",{attrs:{id:"_4-4-视图函数中处理表单"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-视图函数中处理表单"}},[t._v("#")]),t._v(" 4.4 视图函数中处理表单")]),t._v(" "),s("p",[t._v("视图函数"),s("code",[t._v("index()")]),t._v("：")]),t._v(" "),s("ul",[s("li",[t._v("渲染表单")]),t._v(" "),s("li",[t._v("接收表单中的数据")]),t._v(" "),s("li",[t._v("【接收用户从表单中输入后提交的数据，然后在页面上显示】")])]),t._v(" "),s("h2",{attrs:{id:"_4-5-重定向和用户会话"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-重定向和用户会话"}},[t._v("#")]),t._v(" 4.5 重定向和用户会话")]),t._v(" "),s("p",[t._v("hello.py")]),t._v(" "),s("p",[t._v("​"),s("br"),t._v("\n​    from flask import session, redirect, url_for\n​"),s("br"),t._v("\n@app.route('/', methods=['GET', 'POST'])\ndef index():\nform = NameForm()\nif form.validate_on_submit():\nsession['name'] = form.name.data\nreturn redirect(url_for('index'))\nreturn render_template('index.html', form=form, name=session.get('name'),\ncurrent_time=datetime.utcnow())")]),t._v(" "),s("p",[t._v("提交POST请求后，重定向到URL（浏览器向重定向的目标URL发送GET请求）")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("redirect()")]),t._v("函数用来生成HTTP重定向响应")]),t._v(" "),s("li",[t._v("其参数是重定向的URL，通常通过"),s("code",[t._v("url_for()")]),t._v("函数来生成")])]),t._v(" "),s("p",[t._v("用户会话（session）用于在多次请求之间存储数据")]),t._v(" "),s("ul",[s("li",[t._v("默认情况下，用户会话保存在客户端cookies中，使用设置的SECRET_KEY进行加密签名")]),t._v(" "),s("li",[s("code",[t._v("session")]),t._v("是请求上下文中的变量，属于字典类型")])]),t._v(" "),s("h2",{attrs:{id:"_4-6-flash消息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-flash消息"}},[t._v("#")]),t._v(" 4.6 Flash消息")]),t._v(" "),s("p",[t._v("Flask的核心特性，用于提示状态信息 举例：提交的名字和存储在session中的名字不同时，flash消息")]),t._v(" "),s("ol",[s("li",[t._v("修改视图函数")])]),t._v(" "),s("p",[t._v("​"),s("br"),t._v("\n​    from flask import session, redirect, url_for, flash\n​"),s("br"),t._v("\n@app.route('/', methods=['GET', 'POST'])\ndef index():\nform = NameForm()\nif form.validate_on_submit():\nold_name = session.get('name')\nif old_name is not None and old_name != form.name.data:\nflash(\"姓名已修改！\")\nsession['name'] = form.name.data\nreturn redirect(url_for('index'))\nreturn render_template('index.html', form=form, name=session.get('name'),\ncurrent_time=datetime.utcnow())")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("修改模板")])]),t._v(" "),s("div",{staticClass:"language-html line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[t._v(" {% block content %}\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("container"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        {% for message in get_flashed_messages() %}\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("alert alert-warning"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("button"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("close"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("data-dismiss")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("alert"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("×"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            {{ message }}\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        {% endfor %}\n        {% block page_content %}{% endblock %}\n        {% block scripts %}\n        {{ super() }}\n        {{ moment.include_moment() }}\n        {{ moment.lang('zh-cn') }}\n        {% endblock %}\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    {% endblock %}\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br")])]),s("h2",{attrs:{id:"_4-7-效果展示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-效果展示"}},[t._v("#")]),t._v(" 4.7 效果展示")]),t._v(" "),s("p",[t._v("主页效果 "),s("img",{attrs:{src:"https://my-imags.oss-cn-shanghai.aliyuncs.com/pic/20210312154954.png",alt:""}}),t._v("\n直接点击提交按钮效果 "),s("img",{attrs:{src:"https://my-imags.oss-cn-shanghai.aliyuncs.com/pic/20210312155030.png",alt:""}}),t._v(" 文本框中输入空格后点击提交效果 "),s("img",{attrs:{src:"https://my-imags.oss-cn-shanghai.aliyuncs.com/pic/20210312155101.png",alt:""}}),t._v(" 文本框中输入“广慕君”，点击提交后效果\n"),s("img",{attrs:{src:"https://my-imags.oss-cn-shanghai.aliyuncs.com/pic/20210312155126.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"_4-8-问题解决"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-8-问题解决"}},[t._v("#")]),t._v(" 4.8 问题解决")]),t._v(" "),s("p",[s("strong",[t._v("问题一：")])]),t._v(" "),s("p",[t._v("​"),s("br"),t._v("\n​    TypeError: 'DataRequired' object is not iterable")]),t._v(" "),s("p",[s("strong",[t._v("解决：")])]),t._v(" "),s("p",[t._v("​"),s("br"),t._v("\n​    name = StringField('请输入你的名字：', validators=[DataRequired()])")]),t._v(" "),s("p",[s("code",[t._v("DataRequired()")]),t._v("是列表的元素，列表是可以迭代的")])])}),[],!1,null,null,null);a.default=e.exports}}]);