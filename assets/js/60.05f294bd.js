(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{635:function(s,t,a){"use strict";a.r(t);var e=a(7),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("p",[s._v("​"),a("br"),s._v("\npip install pyinstaller")]),s._v(" "),a("h2",{attrs:{id:"整体流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整体流程"}},[s._v("#")]),s._v(" 整体流程")]),s._v(" "),a("p",[s._v("​"),a("br"),s._v("\npyi-makespec xxx.py     # 先生成spec文件\npyinstaller xxx.spec    # 再生成exe文件")]),s._v(" "),a("h2",{attrs:{id:"参数说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参数说明"}},[s._v("#")]),s._v(" 参数说明")]),s._v(" "),a("p",[a("code",[s._v("-F")]),s._v(" ：打包成一个exe文件（在dist文件夹下）")]),s._v(" "),a("p",[s._v("​"),a("br"),s._v("\npyi-makespec -F xxx.py\npyinstaller xxx.spec")]),s._v(" "),a("p",[a("code",[s._v("-D")]),s._v(" ：生成一个包含exe的文件夹")]),s._v(" "),a("p",[s._v("​"),a("br"),s._v("\npyi-makespec -D xxx.py\npyinstaller xxx.spec")]),s._v(" "),a("h2",{attrs:{id:"单一py文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单一py文件"}},[s._v("#")]),s._v(" 单一PY文件")]),s._v(" "),a("p",[s._v("按上述操作即可")]),s._v(" "),a("h2",{attrs:{id:"包含数据文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#包含数据文件"}},[s._v("#")]),s._v(" 包含数据文件")]),s._v(" "),a("p",[s._v("用文本编辑器打开spec文件，修改文件中的参数 "),a("code",[s._v("datas=[]")]),s._v(" 例如要打包 "),a("code",[s._v("global_popu.tif")]),s._v(" 到exe中时")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("pec文件中的参数修改为"),a("code",[s._v("datas=[('global_popu.tif', '.')]")])])]),s._v(" "),a("li",[a("p",[s._v("然后将spec文件编译成exe，两点注意：")]),s._v(" "),a("ol",[a("li",[s._v("将数据文件和xxx.py文件放在同一目录\n2. 对xxx.py程序读取数据的部分需要修改，修改方法如下")])])])]),s._v(" "),a("p",[s._v("​"),a("br"),s._v("\na = Analysis(['trip_popu.py'],\npathex=['E:\\GitHub\\Zone\\Zone'],\nbinaries=[],\ndatas=[('global_popu.tif', '.')],\nhiddenimports=[],\nhookspath=[],\nruntime_hooks=[],\nexcludes=[],\nwin_no_prefer_redirects=False,\nwin_private_assemblies=False,\ncipher=block_cipher,\nnoarchive=False)")]),s._v(" "),a("p",[s._v("​"),a("br"),s._v("\n​"),a("br"),s._v("\n# 对xxx.py的修改\n# 添加自定义的函数\ndef resource_path(relative_path):"),a("br"),s._v("\nbase_path = getattr("),a("br"),s._v("\nsys, '_MEIPASS', os.path.dirname("),a("br"),s._v("\nos.path.abspath("),a("strong",[s._v("file")]),s._v(")))"),a("br"),s._v("\nreturn os.path.join(base_path, relative_path)")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v('#global_popu_Dic = resource_path("global_popu.tif")  # 打包时使用\nglobal_popu_Dic = "../data/global_popu.tif"         # 调试时使用\n')])])]),a("p",[s._v("如果要打包两个或者多个数据文件，则对spec中的"),a("code",[s._v("datas")]),s._v(" 修改参考下例： "),a("code",[s._v("datas=[('china_light_2016.tif', '.'),('china_population_2016.tif', '.')]")])]),s._v(" "),a("h2",{attrs:{id:"多个py文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多个py文件"}},[s._v("#")]),s._v(" 多个PY文件")]),s._v(" "),a("p",[s._v("整体操作与上述类似，关键在于修改spec中的参数 例如：code文件夹下的trip_popu.py用到了zone_func文件夹目录下的func.py文件，\n在spec文件中的"),a("code",[s._v("Analysis")]),s._v("的第一个参数中加上func.py文件的绝对路径，然后生成exe即可")]),s._v(" "),a("p",[s._v("​"),a("br"),s._v("\na = Analysis(['trip_popu.py','E:\\GitHub\\Zone\\Zone\\zone_func\\func.py'],\npathex=['E:\\GitHub\\Zone\\Zone'],\nbinaries=[],\ndatas=[('global_popu.tif', '.')],\nhiddenimports=[],\nhookspath=[],\nruntime_hooks=[],\nexcludes=[],\nwin_no_prefer_redirects=False,\nwin_private_assemblies=False,\ncipher=block_cipher,\nnoarchive=False)")]),s._v(" "),a("h2",{attrs:{id:"多进程打包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多进程打包"}},[s._v("#")]),s._v(" 多进程打包")]),s._v(" "),a("p",[s._v("编写的程序中包含多进程处理时，正常打包运行exe后，电脑会卡死 所以在打包前，需先要对xxx.py文件进行修改，修改内容为：")]),s._v(" "),a("p",[s._v("​"),a("br"),s._v("\nimport multiprocessing")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v('if __name__ == "__main__":\n    multiprocessing.freeze_support()    # 这一句一定要放在if __name__ == "__main__":下面\n')])])]),a("p",[s._v("修改后，正常打包即可")]),s._v(" "),a("h2",{attrs:{id:"问题记录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题记录"}},[s._v("#")]),s._v(" 问题记录")]),s._v(" "),a("ol",[a("li",[s._v("程序有使用到shapely库,打包时会提示 "),a("strong",[s._v("缺少geos.dll")]),s._v(" 将提示的shapely库的路径下的geos_c.dll复制一份重命名为geos.dll,重新打包即可")]),s._v(" "),a("li",[s._v("程序有使用到geopandas库,打包时运行后提示")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v('File "site-packages\\geopandas\\datasets\\__init__.py", line 7, in \nStopIteration\n[6764] Failed to execute script application\n')])])]),a("p",[s._v("找到geopandas库文件下的"),a("code",[s._v("__init__.py")]),s._v(",将"),a("code",[s._v("import geopandas.datasets")]),s._v("这句注释掉")]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[a("p",[s._v("程序有使用到sklearn库时,打包运行时提示缺少一些模块,如"),a("code",[s._v("sklearn.utils._cython_blas")]),s._v(" 修改spec文件中的"),a("code",[s._v("hiddenimports")]),s._v("参数后,重新打包,修改如下")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Analysis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mainarea_buffer.py'")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'E:"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("GitHub"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("Zone"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("Zone"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("zone_func"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("func.py'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pathex")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'E:"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("GitHub"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("Zone"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("Zone'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("binaries")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("datas")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'global_popu.tif'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("hiddenimports")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sklearn.utils._cython_blas'")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cython'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sklearn'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sklearn.ensemble'")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sklearn.neighbors.typedefs'")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sklearn.neighbors.quad_tree'")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sklearn.tree._utils'")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'scipy._lib.messagestream'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("hookspath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("runtime_hooks")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("excludes")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win_no_prefer_redirects")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("False,\n        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("win_private_assemblies")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("False,\n        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cipher")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("block_cipher,\n        "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("noarchive")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("False"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])])])]),s._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),a("p",[s._v("Github："),a("a",{attrs:{href:"https://github.com/guangmujun",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/guangmujun"),a("OutboundLink")],1),s._v(" CSDN :\n"),a("a",{attrs:{href:"https://me.csdn.net/qq_37054356",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://me.csdn.net/qq_37054356"),a("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=n.exports}}]);